<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EatsMenu - Crie seu Cardápio Digital Grátis</title>
    <meta name="description" content="Sistema de cardápio digital e pedidos via WhatsApp. Sem taxas, sem maquininha.">
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    
    <style>
        :root { --primary: #00e676; --bg: #050505; --text: #fff; --border: #333; }
        body { margin: 0; font-family: 'Outfit', sans-serif; background: var(--bg); color: var(--text); overflow-x: hidden; }
        
        .navbar { padding: 20px 5%; display: flex; justify-content: space-between; align-items: center; position: fixed; width: 100%; top: 0; background: rgba(0,0,0,0.8); backdrop-filter: blur(10px); z-index: 100; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .logo { font-size: 1.5rem; font-weight: 800; color: #fff; text-transform: uppercase; }
        .logo span { color: var(--primary); }
        
        .hero { padding: 180px 20px 100px; text-align: center; min-height: 100vh; background: radial-gradient(circle at top, rgba(0,230,118,0.1), #000 70%); }
        .hero h1 { font-size: 3.5rem; margin-bottom: 20px; line-height: 1.1; }
        .hero h1 span { color: var(--primary); }
        .hero p { color: #aaa; max-width: 600px; margin: 0 auto 40px; font-size: 1.2rem; }
        
        .btn-cta { background: var(--primary); color: #000; padding: 15px 40px; border-radius: 50px; font-weight: 800; border: none; cursor: pointer; font-size: 1.1rem; box-shadow: 0 0 20px rgba(0,230,118,0.4); transition: 0.3s; }
        .btn-cta:hover { transform: scale(1.05); box-shadow: 0 0 40px rgba(0,230,118,0.6); }
        
        .features { padding: 80px 5%; background: #080808; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; max-width: 1200px; margin: 0 auto; }
        .card { background: #121212; padding: 40px; border-radius: 20px; border: 1px solid #222; text-align: left; }
        .card i { font-size: 2rem; color: var(--primary); margin-bottom: 20px; }
        .card h3 { font-size: 1.5rem; margin-bottom: 10px; }
        
        /* Modal */
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 200; display: none; align-items: center; justify-content: center; }
        .auth-box { background: #111; padding: 40px; border-radius: 20px; width: 100%; max-width: 400px; border: 1px solid #333; position: relative; }
        .input-field { width: 100%; padding: 15px; margin-bottom: 15px; background: #000; border: 1px solid #333; color: #fff; border-radius: 10px; }
        .slug-group { display: flex; align-items: center; background: #000; border: 1px solid #333; border-radius: 10px; margin-bottom: 15px; }
        .slug-group input { border: none; background: transparent; text-align: right; margin: 0; }
        .slug-group span { padding: 0 15px; color: #666; }
        
        .hidden { display: none; }
        #loading-screen { position: fixed; inset: 0; background: #000; z-index: 9999; display: flex; align-items: center; justify-content: center; }
    </style>
</head>
<body>

    <div id="loading-screen"><i class="fas fa-circle-notch fa-spin" style="font-size: 2rem; color: var(--primary);"></i></div>

    <nav class="navbar">
        <div class="logo">EATS<span>MENU</span></div>
        <div>
            <button onclick="openAuth('login')" style="background:transparent; border:1px solid #fff; color:#fff; padding:8px 25px; border-radius:50px; cursor:pointer; margin-right:10px;">Entrar</button>
            <button onclick="openAuth('cadastro')" class="btn-cta" style="padding:8px 25px; font-size:0.9rem;">Criar Conta</button>
        </div>
    </nav>

    <div class="hero">
        <h1>Seu Delivery <br><span>Profissional e Automático</span></h1>
        <p>Transforme seu WhatsApp em uma máquina de vendas. Cardápio digital completo, gestão de entregas e pagamentos. Tudo grátis.</p>
        <button class="btn-cta" onclick="openAuth('cadastro')">CRIAR MINHA LOJA AGORA</button>
    </div>

    <section class="features">
        <div class="grid">
            <div class="card">
                <i class="fas fa-rocket"></i>
                <h3>Rápido e Fácil</h3>
                <p>Crie sua conta e monte seu cardápio em menos de 5 minutos.</p>
            </div>
            <div class="card">
                <i class="fab fa-whatsapp"></i>
                <h3>Pedidos no Zap</h3>
                <p>Receba pedidos organizados com endereço e total calculado.</p>
            </div>
            <div class="card">
                <i class="fas fa-qrcode"></i>
                <h3>QR Code e Link</h3>
                <p>Compartilhe seu link exclusivo ou coloque QR Codes nas mesas.</p>
            </div>
        </div>
    </section>

    <div class="modal" id="auth-modal">
        <div class="auth-box">
            <span onclick="document.getElementById('auth-modal').style.display='none'" style="position:absolute; top:15px; right:20px; cursor:pointer; font-size:1.5rem;">×</span>
            <h2 id="auth-title" style="margin-bottom:20px; text-align:center;">Criar Loja</h2>
            
            <div id="form-cadastro">
                <input class="input-field" id="cad-nome" placeholder="Nome do Estabelecimento">
                <div class="slug-group">
                    <input class="input-field" id="cad-slug" placeholder="seulink" onkeyup="this.value=this.value.toLowerCase().replace(/[^a-z0-9-]/g,'')">
                    <span>.eatsmenu.com.br</span>
                </div>
                <input class="input-field" id="cad-email" placeholder="E-mail">
                <input class="input-field" id="cad-pass" type="password" placeholder="Senha">
                <button class="btn-cta" style="width:100%" onclick="fCadastro()">CRIAR CONTA</button>
                <p style="text-align:center; margin-top:15px; color:#aaa; cursor:pointer;" onclick="toggleAuth('login')">Já tenho conta</p>
            </div>

            <div id="form-login" class="hidden">
                <input class="input-field" id="log-email" placeholder="E-mail">
                <input class="input-field" id="log-pass" type="password" placeholder="Senha">
                <button class="btn-cta" style="width:100%" onclick="fLogin()">ENTRAR</button>
                <p style="text-align:center; margin-top:15px; color:#aaa; cursor:pointer;" onclick="toggleAuth('cadastro')">Criar conta</p>
            </div>
        </div>
    </div>

    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
        import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBIvmoayNis2C2xLFQtpRzzrc4dWxGvotU",
            authDomain: "eatsmenu-62cfa.firebaseapp.com",
            projectId: "eatsmenu-62cfa",
            storageBucket: "eatsmenu-62cfa.firebasestorage.app",
            messagingSenderId: "896131512194",
            appId: "1:896131512194:web:51891cf2bd5a04c6c7819b"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // --- ROTEADOR INTELIGENTE (CORRIGIDO) ---
        (function router() {
            const host = window.location.hostname;
            
            // LISTA DE DOMÍNIOS QUE *DEVEM* FICAR NA HOME (Marketing)
            // Se for um desses, para o loading e não faz nada.
            if (host === 'eatsmenu.com.br' || 
                host === 'www.eatsmenu.com.br' || 
                host.includes('localhost') || 
                host.includes('vercel.app')) {
                
                document.getElementById('loading-screen').style.display = 'none';
                return; // FIM DO SCRIPT: Fica na Home
            } 
            
            // SE NÃO FOR A HOME, ENTÃO É SUBDOMÍNIO (LOJA)
            const parts = host.split('.');
            // Exemplo: pizzaria.eatsmenu.com.br (4 partes)
            // Só redireciona se tiver 4 partes ou mais, o que garante que tem subdomínio
            if (parts.length > 3) { 
                const slug = parts[0];
                if (!['admin', 'painel', 'app', 'login'].includes(slug)) {
                    // Redireciona para o cardápio
                    window.location.replace(`cardapio.html?loja=${slug}`);
                }
            } else {
                // Caso raro onde pode ter passado, garante home
                document.getElementById('loading-screen').style.display = 'none';
            }
        })();

        window.openAuth = (t) => { document.getElementById('auth-modal').style.display='flex'; toggleAuth(t); }
        
        window.toggleAuth = (t) => {
            document.getElementById('form-login').classList.toggle('hidden', t !== 'login');
            document.getElementById('form-cadastro').classList.toggle('hidden', t !== 'cadastro');
            document.getElementById('auth-title').innerText = t==='login'?'Acessar Painel':'Criar Loja';
        }

        window.fCadastro = () => {
            const nome = document.getElementById('cad-nome').value;
            const slug = document.getElementById('cad-slug').value.toLowerCase().replace(/[^a-z0-9-]/g, '');
            const email = document.getElementById('cad-email').value;
            const pass = document.getElementById('cad-pass').value;
            
            if(!nome||!slug||!email||!pass) return notify("Preencha tudo", "error");

            createUserWithEmailAndPassword(auth, email, pass).then(async(c)=>{
                await setDoc(doc(db,"lojas",c.user.uid), { 
                    nome, slug, email, produtos:[], bairros:[], cor:"#00e676", 
                    hora_abre:"18:00", hora_fecha:"23:00", data_criacao: new Date()
                });
                notify("Loja criada com sucesso!");
                setTimeout(() => window.location.href="admin.html", 1500);
            }).catch(e=>notify(e.message, "error"));
        }

        window.fLogin = () => {
            const email = document.getElementById('log-email').value;
            const pass = document.getElementById('log-pass').value;
            signInWithEmailAndPassword(auth, email, pass).then(()=>window.location.href="admin.html").catch(e=>notify("Erro no login", "error"));
        }

        function notify(msg, type="success") {
            Toastify({ text: msg, style: { background: type==="success"?"#00e676":"#ff1744", color:"#000", fontWeight:"bold" } }).showToast();
        }
    </script>
</body>
</html>
