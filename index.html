<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EatsMenu - Seu Delivery no WhatsApp</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    
    <style>
        /* --- ESTILOS GERAIS --- */
        :root { --primary: #00e676; --secondary: #ffea00; --bg: #0a0a0a; --surface: #1a1a1a; --text: #ffffff; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; outline: none; }
        body { background-color: var(--bg); color: var(--text); line-height: 1.6; overflow-x: hidden; }
        .hidden { display: none !important; }

        /* LOADING INICIAL (ROTEADOR) */
        #loading-router { position: fixed; inset: 0; background: #000; z-index: 9999; display: flex; align-items: center; justify-content: center; flex-direction: column; }

        /* --- ESTILOS DA HOME DE VENDAS --- */
        header { padding: 20px; display: flex; justify-content: space-between; align-items: center; max-width: 1200px; margin: 0 auto; width: 100%; }
        .logo { font-size: 1.8rem; font-weight: 800; color: var(--primary); text-transform: uppercase; }
        .logo span { color: #fff; }
        
        .header-actions { display: flex; gap: 15px; align-items: center; }
        .btn-main { background: var(--primary); color: #000; padding: 12px 25px; border-radius: 50px; font-weight: 800; text-decoration: none; border: none; cursor: pointer; transition: 0.3s; box-shadow: 0 0 15px rgba(0,230,118,0.3); }
        .btn-main:hover { transform: scale(1.05); }
        .btn-outline { background: transparent; color: var(--text); padding: 10px 20px; border-radius: 50px; font-weight: 600; border: 1px solid #555; cursor: pointer; transition: 0.3s; }
        .btn-outline:hover { border-color: var(--primary); color: var(--primary); }

        .hero { padding: 100px 20px; text-align: center; background: radial-gradient(circle at top, #00e67611 0%, #0a0a0a 70%); }
        .hero h1 { font-size: 3.5rem; font-weight: 800; margin-bottom: 20px; line-height: 1.1; }
        .hero p { font-size: 1.2rem; color: #aaa; margin-bottom: 40px; max-width: 700px; margin-left: auto; margin-right: auto; }
        
        .features { padding: 60px 20px; max-width: 1100px; margin: 0 auto; display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 30px; }
        .f-card { background: var(--surface); padding: 40px; border-radius: 20px; border: 1px solid #333; transition: 0.3s; text-align: center; }
        .f-card:hover { border-color: var(--primary); transform: translateY(-5px); }
        .f-card i { font-size: 2.5rem; color: var(--secondary); margin-bottom: 20px; }

        /* MODAL DE LOGIN/CADASTRO */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); backdrop-filter: blur(8px); z-index: 999; display: none; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.3s ease; }
        .modal-overlay.open { display: flex; opacity: 1; }
        .modal-box { background: var(--surface); padding: 40px; border-radius: 20px; width: 100%; max-width: 420px; border: 1px solid #333; position: relative; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        
        .input-group { margin-bottom: 15px; text-align: left; }
        .input-group label { display: block; margin-bottom: 8px; color: #ccc; font-size: 0.9rem; font-weight: 600; }
        .input-field { width: 100%; background: #000; border: 1px solid #333; color: #fff; padding: 15px; border-radius: 10px; font-size: 1rem; transition: 0.3s; }
        .input-field:focus { border-color: var(--primary); }
        
        .btn-close { position: absolute; top: 15px; right: 15px; background: none; border: none; color: #666; font-size: 1.5rem; cursor: pointer; }
        .toggle-form { text-align: center; margin-top: 20px; font-size: 0.9rem; color: #aaa; }
        .toggle-form span { color: var(--primary); cursor: pointer; font-weight: bold; text-decoration: underline; }

        /* --- ESTILOS DO CARD√ÅPIO (SUBDOM√çNIO) --- */
        .loja-header { background: var(--surface); padding: 30px 20px; text-align: center; border-bottom: 2px solid var(--primary); margin-bottom: 20px; border-radius: 0 0 30px 30px; }
        .prod-card { background: var(--surface); padding: 15px; margin: 10px auto; max-width: 600px; border-radius: 15px; display: flex; justify-content: space-between; border: 1px solid #333; align-items: center; }
        .cart-bar { position: fixed; bottom: 20px; left: 20px; right: 20px; background: var(--primary); color: #000; padding: 15px; border-radius: 50px; text-align: center; font-weight: 800; max-width: 500px; margin: 0 auto; cursor: pointer; box-shadow: 0 5px 20px rgba(0,230,118,0.4); display: none; }
    </style>
</head>
<body>

    <div id="loading-router">
        <i class="fas fa-circle-notch fa-spin" style="font-size: 3rem; color: var(--primary);"></i>
        <p style="margin-top: 15px; color: #fff;">Carregando...</p>
    </div>

    <div id="app-home" class="hidden">
        <header>
            <div class="logo">EATS<span>MENU</span></div>
            <div class="header-actions">
                <button onclick="abrirModal('login')" class="btn-outline">Entrar</button>
                <button onclick="abrirModal('cadastro')" class="btn-main">Criar Conta</button>
            </div>
        </header>

        <section class="hero">
            <h1>Seu Card√°pio Digital <br><span style="color: var(--primary)">Profissional e Gr√°tis</span></h1>
            <p>Transforme seu WhatsApp em uma m√°quina de vendas. Sem taxas por pedido, sem mensalidade obrigat√≥ria.</p>
            <button onclick="abrirModal('cadastro')" class="btn-main" style="padding: 15px 40px; font-size: 1.2rem; margin-top: 20px;">Come√ßar Agora üöÄ</button>
        </section>

        <section class="features">
            <div class="f-card">
                <i class="fas fa-bolt"></i>
                <h3>R√°pido e F√°cil</h3>
                <p>Crie sua loja em menos de 2 minutos. Basta cadastrar e adicionar produtos.</p>
            </div>
            <div class="f-card">
                <i class="fab fa-whatsapp"></i>
                <h3>Pedidos no Zap</h3>
                <p>Receba pedidos formatados e organizados direto no seu WhatsApp.</p>
            </div>
            <div class="f-card">
                <i class="fas fa-qrcode"></i>
                <h3>Link Pr√≥prio</h3>
                <p>Seu link exclusivo (ex: sualoja.eatsmenu.com.br) para divulgar no Instagram.</p>
            </div>
        </section>

        <footer style="text-align: center; padding: 40px; color: #555; font-size: 0.9rem;">
            &copy; 2026 EatsMenu. Todos os direitos reservados.
        </footer>

        <div class="modal-overlay" id="modal-auth">
            <div class="modal-box">
                <button class="btn-close" onclick="fecharModal()">√ó</button>
                
                <div id="form-login">
                    <h2 style="color: var(--primary); margin-bottom: 20px; text-align: center;">√Årea do Cliente</h2>
                    <div class="input-group">
                        <label>E-mail</label>
                        <input type="email" id="log-email" class="input-field" placeholder="seu@email.com">
                    </div>
                    <div class="input-group">
                        <label>Senha</label>
                        <input type="password" id="log-senha" class="input-field">
                    </div>
                    <button onclick="fazerLogin()" class="btn-main" style="width: 100%;">Entrar no Painel</button>
                    <div class="toggle-form">
                        Ainda n√£o tem conta? <span onclick="toggleMode('cadastro')">Crie agora</span>
                    </div>
                </div>

                <div id="form-cadastro" class="hidden">
                    <h2 style="color: var(--primary); margin-bottom: 20px; text-align: center;">Criar Nova Loja</h2>
                    <div class="input-group">
                        <label>Nome da Loja</label>
                        <input type="text" id="cad-nome" class="input-field" placeholder="Ex: Burger King">
                    </div>
                    
                    <div class="input-group">
                        <label>Link Desejado (Slug)</label>
                        <div style="display:flex; align-items:center; background:#000; border:1px solid #333; border-radius:10px;">
                            <input type="text" id="cad-slug" class="input-field" placeholder="nomedaloja" style="border:none; text-align:right; padding-right:5px;" onkeyup="limparSlug(this)">
                            <span style="color:#666; padding:15px 15px 15px 0;">.eatsmenu...</span>
                        </div>
                        <small style="color:#666; font-size:0.8rem">Isso ser√° seu site.</small>
                    </div>

                    <div class="input-group">
                        <label>E-mail</label>
                        <input type="email" id="cad-email" class="input-field">
                    </div>
                    <div class="input-group">
                        <label>Senha</label>
                        <input type="password" id="cad-senha" class="input-field">
                    </div>
                    <button onclick="fazerCadastro()" class="btn-main" style="width: 100%;">Criar Loja Gr√°tis</button>
                    <div class="toggle-form">
                        J√° tem conta? <span onclick="toggleMode('login')">Fazer Login</span>
                    </div>
                </div>
                
                <p id="msg-erro" style="color: #ff1744; text-align: center; margin-top: 15px; font-size: 0.9rem; font-weight: bold;"></p>
            </div>
        </div>
    </div>

    <div id="app-loja" class="hidden">
        <div class="loja-header">
            <h1 id="loja-nome" style="color:var(--primary); font-weight:800">...</h1>
            <p id="loja-zap" style="color:#aaa">...</p>
        </div>
        
        <div id="lista-categorias" style="max-width:600px; margin:0 auto; padding:0 20px; display:flex; gap:10px; overflow-x:auto; padding-bottom:15px;">
            </div>

        <div id="lista-produtos" style="padding: 20px; padding-top:0;">
            </div>

        <div class="cart-bar" id="cart-bar" onclick="enviarPedido()">
            <i class="fab fa-whatsapp"></i> Fechar Pedido
        </div>
    </div>

    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
        import { getFirestore, collection, query, where, getDocs, doc, setDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        // SUA CONFIGURA√á√ÉO FIREBASE
        const firebaseConfig = {
            apiKey: "AIzaSyBIvmoayNis2C2xLFQtpRzzrc4dWxGvotU",
            authDomain: "eatsmenu-62cfa.firebaseapp.com",
            projectId: "eatsmenu-62cfa",
            storageBucket: "eatsmenu-62cfa.firebasestorage.app",
            messagingSenderId: "896131512194",
            appId: "1:896131512194:web:51891cf2bd5a04c6c7819b",
            measurementId: "G-C93RE659DN"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // --- SISTEMA DE ROTEAMENTO (SUBDOM√çNIO vs HOME) ---
        async function router() {
            const host = window.location.hostname; 
            
            // Verifica se est√° na Home Principal
            if (host === 'eatsmenu.com.br' || host === 'www.eatsmenu.com.br' || host.includes('localhost') || host.includes('vercel.app')) {
                mostrarHome();
            } else {
                // √â um subdom√≠nio (Ex: pastelanches.eatsmenu.com.br)
                const subdominio = host.split('.')[0]; 
                
                // Exce√ß√µes para painel admin
                if(subdominio === 'admin' || subdominio === 'app' || subdominio === 'painel') {
                    window.location.href = "admin.html";
                    return;
                }

                await carregarLojaPeloSlug(subdominio);
            }
        }

        function mostrarHome() {
            document.getElementById('loading-router').style.display = 'none';
            document.getElementById('app-home').classList.remove('hidden');
        }

        // --- L√ìGICA DA LOJA (SUBDOM√çNIO) ---
        let lojaAtual = null;
        let carrinho = [];

        async function carregarLojaPeloSlug(slug) {
            try {
                const q = query(collection(db, "lojas"), where("slug", "==", slug));
                const querySnapshot = await getDocs(q);

                if (!querySnapshot.empty) {
                    lojaAtual = querySnapshot.docs[0].data();
                    renderizarLoja(lojaAtual);
                } else {
                    document.body.innerHTML = `
                        <div style="text-align:center; padding:50px; color:#fff;">
                            <h1>Loja n√£o encontrada üòï</h1>
                            <p>O endere√ßo <b>${slug}.eatsmenu.com.br</b> n√£o existe.</p>
                            <br>
                            <a href="https://eatsmenu.com.br" style="color:#00e676;">Criar esta loja agora</a>
                        </div>`;
                    document.getElementById('loading-router').style.display = 'none';
                }
            } catch (error) {
                console.error(error);
                alert("Erro de conex√£o.");
            }
        }

        function renderizarLoja(dados) {
            document.getElementById('loading-router').style.display = 'none';
            document.getElementById('app-loja').classList.remove('hidden');

            document.title = dados.nome;
            document.getElementById('loja-nome').innerText = dados.nome;
            document.getElementById('loja-zap').innerText = "WhatsApp: " + (dados.whatsapp || "N√£o informado");
            
            // Tema
            if(dados.cor) document.documentElement.style.setProperty('--primary', dados.cor);

            // Produtos
            const lista = document.getElementById('lista-produtos');
            lista.innerHTML = "";
            (dados.produtos || []).forEach(p => {
                lista.innerHTML += `
                <div class="prod-card" onclick="addCarrinho('${p.nome}', ${p.preco})">
                    <div>
                        <div style="font-weight:bold; font-size:1.1rem">${p.nome}</div>
                        <small style="color:#aaa">${p.desc || ''}</small>
                        <div style="color:var(--primary); font-weight:800; margin-top:5px">R$ ${p.preco.toFixed(2)}</div>
                    </div>
                    <i class="fas fa-plus-circle" style="color:var(--primary); font-size:1.8rem;"></i>
                </div>`;
            });
        }

        window.addCarrinho = (nome, preco) => {
            carrinho.push({nome, preco});
            const btn = document.getElementById('cart-bar');
            btn.style.display = 'block';
            btn.innerHTML = `<i class="fab fa-whatsapp"></i> Fechar Pedido (${carrinho.length} itens)`;
            Toastify({text: "Item adicionado!", duration: 1000, style: {background: "var(--primary)", color: "#000"}}).showToast();
        }

        window.enviarPedido = () => {
            if(!lojaAtual.whatsapp) return alert("Loja sem WhatsApp configurado.");
            let msg = `*Novo Pedido - ${lojaAtual.nome}*\n------------------\n`;
            let total = 0;
            carrinho.forEach(item => {
                msg += `‚Ä¢ ${item.nome} (R$ ${item.preco.toFixed(2)})\n`;
                total += item.preco;
            });
            msg += `------------------\n*Total: R$ ${total.toFixed(2)}*`;
            window.open(`https://wa.me/${lojaAtual.whatsapp}?text=${encodeURIComponent(msg)}`, '_blank');
        }

        // --- L√ìGICA DE LOGIN/CADASTRO (HOME) ---
        
        // Controle de Modals
        window.abrirModal = (modo) => {
            document.getElementById('modal-auth').classList.add('open');
            window.toggleMode(modo);
        }
        window.fecharModal = () => document.getElementById('modal-auth').classList.remove('open');

        window.toggleMode = (modo) => {
            document.getElementById('msg-erro').innerText = "";
            if(modo === 'cadastro') {
                document.getElementById('form-login').classList.add('hidden');
                document.getElementById('form-cadastro').classList.remove('hidden');
            } else {
                document.getElementById('form-cadastro').classList.add('hidden');
                document.getElementById('form-login').classList.remove('hidden');
            }
        }

        window.limparSlug = (input) => {
            input.value = input.value.toLowerCase().replace(/[^a-z0-9-]/g, '');
        }

        // Fun√ß√£o de Login
        window.fazerLogin = () => {
            const e = document.getElementById('log-email').value;
            const s = document.getElementById('log-senha').value;
            const btn = document.querySelector('#form-login button');

            if(!e || !s) return erro("Preencha e-mail e senha.");
            
            btn.innerText = "Entrando...";
            signInWithEmailAndPassword(auth, e, s)
                .then(() => {
                    Toastify({text: "Login OK!", style: {background: "#00e676", color:"#000"}}).showToast();
                    setTimeout(() => window.location.href = "admin.html", 1000);
                })
                .catch(err => {
                    btn.innerText = "Entrar no Painel";
                    erro("Erro ao entrar. Verifique seus dados.");
                });
        }

        // Fun√ß√£o de Cadastro
        window.fazerCadastro = () => {
            const nome = document.getElementById('cad-nome').value;
            const slug = document.getElementById('cad-slug').value;
            const email = document.getElementById('cad-email').value;
            const senha = document.getElementById('cad-senha').value;
            const btn = document.querySelector('#form-cadastro button');

            if(!nome || !slug || !email || !senha) return erro("Preencha todos os campos!");
            if(slug.length < 3) return erro("O link deve ter pelo menos 3 letras.");

            btn.innerText = "Criando Loja...";
            btn.disabled = true;

            // 1. Verifica se slug j√° existe (opcional, mas recomendado)
            // Aqui vamos tentar criar direto, se falhar o Firestore avisa ou sobrescreve (Cuidado)
            // Para simplificar, vamos criar.
            
            createUserWithEmailAndPassword(auth, email, senha)
                .then(async (userCredential) => {
                    const uid = userCredential.user.uid;
                    
                    // CRIA BANCO DE DADOS
                    await setDoc(doc(db, "lojas", uid), {
                        nome: nome,
                        slug: slug,
                        email: email,
                        produtos: [],
                        whatsapp: "",
                        cor: "#00e676",
                        data_criacao: new Date()
                    });

                    Toastify({text: "Loja Criada! Redirecionando...", style: {background: "#00e676", color:"#000"}}).showToast();
                    setTimeout(() => window.location.href = "admin.html", 1500);
                })
                .catch((error) => {
                    btn.innerText = "Criar Loja Gr√°tis";
                    btn.disabled = false;
                    if(error.code == 'auth/email-already-in-use') erro("E-mail j√° cadastrado.");
                    else if(error.code == 'auth/weak-password') erro("Senha muito fraca (m√≠nimo 6 d√≠gitos).");
                    else erro("Erro: " + error.message);
                });
        }

        function erro(msg) {
            document.getElementById('msg-erro').innerText = msg;
            Toastify({text: msg, style: {background: "#ff1744"}}).showToast();
        }

        // Inicia
        router();
    </script>
</body>
</html>